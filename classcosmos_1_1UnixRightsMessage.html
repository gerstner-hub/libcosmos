<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libcosmos: cosmos::UnixRightsMessage Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libcosmos
   </div>
   <div id="projectbrief">Linux C++ System Programming Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classcosmos_1_1UnixRightsMessage.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="classcosmos_1_1UnixRightsMessage-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">cosmos::UnixRightsMessage Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Wrapper for the SCM_RIGHTS socket ancillary message to pass file descriptors to other processes.  
 <a href="#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>&gt;</code></p>
<div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for cosmos::UnixRightsMessage:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
 <div class="center">
  <img src="classcosmos_1_1UnixRightsMessage.png" usemap="#cosmos::UnixRightsMessage_map" alt=""/>
  <map id="cosmos::UnixRightsMessage_map" name="cosmos::UnixRightsMessage_map">
<area href="classcosmos_1_1AncillaryMessage.html" alt="cosmos::AncillaryMessage&lt; OptLevel::SOCKET, UnixMessage &gt;" shape="rect" coords="0,0,377,24"/>
  </map>
</div></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a2db86e45a6ca216b888fb502c353f72d" id="r_a2db86e45a6ca216b888fb502c353f72d"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2db86e45a6ca216b888fb502c353f72d">FileNumVector</a> = std::vector&lt;<a class="el" href="fs_2types_8hxx.html#a468b915608e0674d5789c5386b72ff92">FileNum</a>&gt;</td></tr>
<tr class="memdesc:a2db86e45a6ca216b888fb502c353f72d"><td class="mdescLeft">&#160;</td><td class="mdescRight">A vector to keep a series of FileNum file descriptor numbers to pass between processes.  <br /></td></tr>
<tr class="separator:a2db86e45a6ca216b888fb502c353f72d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:acd2460013a7494db244bffcf7ce6d39e" id="r_acd2460013a7494db244bffcf7ce6d39e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#acd2460013a7494db244bffcf7ce6d39e">deserialize</a> (const <a class="el" href="classcosmos_1_1ReceiveMessageHeader_1_1ControlMessage.html">ReceiveMessageHeader::ControlMessage</a> &amp;msg)</td></tr>
<tr class="memdesc:acd2460013a7494db244bffcf7ce6d39e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse received file descriptors from the given ControlMessage.  <br /></td></tr>
<tr class="separator:acd2460013a7494db244bffcf7ce6d39e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab78d135cd2c3549c9fb49f0b21ee5a0a" id="r_ab78d135cd2c3549c9fb49f0b21ee5a0a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classcosmos_1_1SendMessageHeader_1_1ControlMessage.html">SendMessageHeader::ControlMessage</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab78d135cd2c3549c9fb49f0b21ee5a0a">serialize</a> () const</td></tr>
<tr class="memdesc:ab78d135cd2c3549c9fb49f0b21ee5a0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serialize a ControlMessage for passing file descriptors.  <br /></td></tr>
<tr class="separator:ab78d135cd2c3549c9fb49f0b21ee5a0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2d35a083a6d4f3b6b7b5aef62e1baa8" id="r_af2d35a083a6d4f3b6b7b5aef62e1baa8"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af2d35a083a6d4f3b6b7b5aef62e1baa8">addFD</a> (<a class="el" href="fs_2types_8hxx.html#a468b915608e0674d5789c5386b72ff92">cosmos::FileNum</a> fd)</td></tr>
<tr class="separator:af2d35a083a6d4f3b6b7b5aef62e1baa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace72db78a271626eb47c63c31cb4f840" id="r_ace72db78a271626eb47c63c31cb4f840"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ace72db78a271626eb47c63c31cb4f840">clearFDs</a> ()</td></tr>
<tr class="separator:ace72db78a271626eb47c63c31cb4f840"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab58eec3d7df2910868dc8c9a830fe2c0" id="r_ab58eec3d7df2910868dc8c9a830fe2c0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab58eec3d7df2910868dc8c9a830fe2c0">takeFDs</a> (<a class="el" href="#a2db86e45a6ca216b888fb502c353f72d">FileNumVector</a> &amp;fds)</td></tr>
<tr class="separator:ab58eec3d7df2910868dc8c9a830fe2c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1101cf181018fe4c71869a0e35cdf4d6" id="r_a1101cf181018fe4c71869a0e35cdf4d6"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1101cf181018fe4c71869a0e35cdf4d6">numFDs</a> () const</td></tr>
<tr class="separator:a1101cf181018fe4c71869a0e35cdf4d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-attribs" name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:a302b6595fb59f78b80fff09d13a57207" id="r_a302b6595fb59f78b80fff09d13a57207"><td class="memItemLeft" align="right" valign="top">static constexpr size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a302b6595fb59f78b80fff09d13a57207">MAX_FDS</a> = 253</td></tr>
<tr class="memdesc:a302b6595fb59f78b80fff09d13a57207"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum number of file descriptors that can be transferred using a single <a class="el" href="classcosmos_1_1UnixRightsMessage.html" title="Wrapper for the SCM_RIGHTS socket ancillary message to pass file descriptors to other processes.">UnixRightsMessage</a>.  <br /></td></tr>
<tr class="separator:a302b6595fb59f78b80fff09d13a57207"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-methods" name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a2f582637609cc462d294d89f5745063f" id="r_a2f582637609cc462d294d89f5745063f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f582637609cc462d294d89f5745063f">closeUnclaimed</a> ()</td></tr>
<tr class="separator:a2f582637609cc462d294d89f5745063f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pro_methods_classcosmos_1_1AncillaryMessage"><td colspan="2" onclick="javascript:dynsection.toggleInherit('pro_methods_classcosmos_1_1AncillaryMessage')"><img src="closed.png" alt="-"/>&#160;Protected Member Functions inherited from <a class="el" href="classcosmos_1_1AncillaryMessage.html">cosmos::AncillaryMessage&lt; OptLevel::SOCKET, UnixMessage &gt;</a></td></tr>
<tr class="memitem:ad723c5146d4cfdd4bee5b9263b9eb30e inherit pro_methods_classcosmos_1_1AncillaryMessage" id="r_ad723c5146d4cfdd4bee5b9263b9eb30e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classcosmos_1_1SendMessageHeader_1_1ControlMessage.html">SendMessageHeader::ControlMessage</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcosmos_1_1AncillaryMessage.html#ad723c5146d4cfdd4bee5b9263b9eb30e">createMsg</a> (<a class="el" href="net_2types_8hxx.html#af4840ff9a71d3468db26fe550c0e3b7a">UnixMessage</a> type, const size_t data_len) const</td></tr>
<tr class="separator:ad723c5146d4cfdd4bee5b9263b9eb30e inherit pro_methods_classcosmos_1_1AncillaryMessage"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d82fca94c1964a82246f7e0af9cda69 inherit pro_methods_classcosmos_1_1AncillaryMessage" id="r_a9d82fca94c1964a82246f7e0af9cda69"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcosmos_1_1AncillaryMessage.html#a9d82fca94c1964a82246f7e0af9cda69">checkMsg</a> (const <a class="el" href="classcosmos_1_1ReceiveMessageHeader_1_1ControlMessage.html">ReceiveMessageHeader::ControlMessage</a> &amp;msg, <a class="el" href="net_2types_8hxx.html#af4840ff9a71d3468db26fe550c0e3b7a">UnixMessage</a> type) const</td></tr>
<tr class="separator:a9d82fca94c1964a82246f7e0af9cda69 inherit pro_methods_classcosmos_1_1AncillaryMessage"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add2e9ce88f6aff4de964a9b09da26994 inherit pro_methods_classcosmos_1_1AncillaryMessage" id="r_add2e9ce88f6aff4de964a9b09da26994"><td class="memItemLeft" align="right" valign="top">uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classcosmos_1_1AncillaryMessage.html#add2e9ce88f6aff4de964a9b09da26994">data</a> (<a class="el" href="classcosmos_1_1SendMessageHeader_1_1ControlMessage.html">SendMessageHeader::ControlMessage</a> &amp;msg) const</td></tr>
<tr class="separator:add2e9ce88f6aff4de964a9b09da26994 inherit pro_methods_classcosmos_1_1AncillaryMessage"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pro-attribs" name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a74768d1da14c864ae441ada8a295afa2" id="r_a74768d1da14c864ae441ada8a295afa2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="#a2db86e45a6ca216b888fb502c353f72d">FileNumVector</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a74768d1da14c864ae441ada8a295afa2">m_fds</a></td></tr>
<tr class="separator:a74768d1da14c864ae441ada8a295afa2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a158cec8051637e1422fd38f99bd60e80" id="r_a158cec8051637e1422fd38f99bd60e80"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a158cec8051637e1422fd38f99bd60e80">m_unclaimed_fds</a> = false</td></tr>
<tr class="memdesc:a158cec8051637e1422fd38f99bd60e80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag whether "live" FDs in m_fds have not yet been collected.  <br /></td></tr>
<tr class="separator:a158cec8051637e1422fd38f99bd60e80"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Wrapper for the SCM_RIGHTS socket ancillary message to pass file descriptors to other processes. </p>
<p>UNIX domain sockets can be used to pass file descriptors between unrelated processes. This class supports both, assembling an ancillary message to pass on file descriptors to another process, and deserializing an ancillary message to access file descriptors received from another process.</p>
<p>For sending add the desired file descriptors to the object using <code>addFD()</code>. The object will not take ownership of the file descriptors and will never close them. The file descriptors need to stay valid until the ancillary message has been successfully sent out, though. The final ancillary message can be created using the <a class="el" href="#ab78d135cd2c3549c9fb49f0b21ee5a0a" title="Serialize a ControlMessage for passing file descriptors.">serialize()</a> method. The resulting <a class="el" href="classcosmos_1_1SendMessageHeader_1_1ControlMessage.html" title="Wrapper for struct cmsghdr used for creating new control messages for sending.">SendMessageHeader::ControlMessage</a> can be assigned to the <code>control_msg</code> member of a <code><a class="el" href="classcosmos_1_1SendMessageHeader.html" title="Wrapper for struct msghdr for sending messages via Socket::sendMessage().">SendMessageHeader</a></code> instance, for sending it via <code><a class="el" href="classcosmos_1_1Socket.html#a130a97f1f17791c80aecf066e729c1aa" title="Sends a message over the socket using extended SendMessageHeader data.">Socket::sendMessage()</a></code> or one of its specializations.</p>
<p>For receiving setup a <code><a class="el" href="classcosmos_1_1ReceiveMessageHeader.html" title="Wrapper for struct msghdr for receiving message via Socket::receiveMessage().">ReceiveMessageHeader</a></code> for use with a UNIX domain socket, call setControlBufferSize() on it to allow reception of ancillary data. On successful reception check for a ControlMessage on <a class="el" href="net_2types_8hxx.html#a499d4442946e684243c0e791c4604f6aa75fbea08c09e684e6b3f3961761354fa" title="used for generic socket options and UNIX domain sockets">OptLevel::SOCKET</a> and of type <a class="el" href="net_2types_8hxx.html#af4840ff9a71d3468db26fe550c0e3b7aaedc618e5803064535d20c5b007f6a9f7" title="file descriptor passing.">UnixMessage::RIGHTS</a>. Once this message arrives, pass it to the <code><a class="el" href="#acd2460013a7494db244bffcf7ce6d39e" title="Parse received file descriptors from the given ControlMessage.">deserialize()</a></code> function to parse the file descriptor numbers that have been received. At this point the file descriptors will be allocated in the receiving process and ownership of them needs to be managed. The <code>takeFDs()</code> function transfers the ownership of received file descriptors to the caller. This operation can only happen once. If for some reason the file descriptors are never claimed, then they are closed internally upon destruction of the object or before the object state is modified in other ways.</p>
<p>There are a number of pitfalls with this mechanism:</p>
<ul>
<li>when sending a <a class="el" href="classcosmos_1_1UnixRightsMessage.html" title="Wrapper for the SCM_RIGHTS socket ancillary message to pass file descriptors to other processes.">UnixRightsMessage</a> it is best to send some actual payload in the <a class="el" href="classcosmos_1_1SendMessageHeader.html" title="Wrapper for struct msghdr for sending messages via Socket::sendMessage().">SendMessageHeader</a> used for this. On Linux when using a <a class="el" href="classcosmos_1_1UnixDatagramSocket.html" title="Implementation of a UNIX domain datagram socket.">UnixDatagramSocket</a> then this is not strictly necessary. For all other socket types at least on byte of payload data is necessary for successfully passing the ancillary message though.</li>
<li>when receiving a <a class="el" href="classcosmos_1_1UnixRightsMessage.html" title="Wrapper for the SCM_RIGHTS socket ancillary message to pass file descriptors to other processes.">UnixRightsMessage</a> then the received file descriptors will automatically be allocated in the current process. If an application fails to parse the message or take ownership of the file descriptors then they will leak. This can lead to a denial-of-service situation especially if the process at the other end is from a different security domain.</li>
<li>when the control message buffer is too small upon reception of a <a class="el" href="classcosmos_1_1UnixRightsMessage.html" title="Wrapper for the SCM_RIGHTS socket ancillary message to pass file descriptors to other processes.">UnixRightsMessage</a> then the control message can be truncated (check Messageflag::CTL_WAS_TRUNCATED). In this case parts of the received file descriptors will be closed again (or not allocated in the first place).</li>
<li>the order and payload/ancillary message combination used for sending the file descriptors can change on the receiving side. Design your application to accept ancillary messages on the receiving end for as long as you expect such a transmission. Don't wait for a specific payload message accompanied by the file descriptors. </li>
</ul>

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00106">106</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a2db86e45a6ca216b888fb502c353f72d" name="a2db86e45a6ca216b888fb502c353f72d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2db86e45a6ca216b888fb502c353f72d">&#9670;&#160;</a></span>FileNumVector</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#a2db86e45a6ca216b888fb502c353f72d">cosmos::UnixRightsMessage::FileNumVector</a> = std::vector&lt;<a class="el" href="fs_2types_8hxx.html#a468b915608e0674d5789c5386b72ff92">FileNum</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A vector to keep a series of FileNum file descriptor numbers to pass between processes. </p>

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00111">111</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a7175971cf8df0ae05452437ef32b6154" name="a7175971cf8df0ae05452437ef32b6154"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7175971cf8df0ae05452437ef32b6154">&#9670;&#160;</a></span>~UnixRightsMessage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">cosmos::UnixRightsMessage::~UnixRightsMessage </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00120">120</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  120</span>                             {</div>
<div class="line"><span class="lineno">  121</span>                closeUnclaimed();</div>
<div class="line"><span class="lineno">  122</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="af2d35a083a6d4f3b6b7b5aef62e1baa8" name="af2d35a083a6d4f3b6b7b5aef62e1baa8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af2d35a083a6d4f3b6b7b5aef62e1baa8">&#9670;&#160;</a></span>addFD()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cosmos::UnixRightsMessage::addFD </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="fs_2types_8hxx.html#a468b915608e0674d5789c5386b72ff92">cosmos::FileNum</a></td>          <td class="paramname"><span class="paramname"><em>fd</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00141">141</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  141</span>                                     {</div>
<div class="line"><span class="lineno">  142</span>                m_fds.push_back(fd);</div>
<div class="line"><span class="lineno">  143</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ace72db78a271626eb47c63c31cb4f840" name="ace72db78a271626eb47c63c31cb4f840"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace72db78a271626eb47c63c31cb4f840">&#9670;&#160;</a></span>clearFDs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cosmos::UnixRightsMessage::clearFDs </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00145">145</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  145</span>                        {</div>
<div class="line"><span class="lineno">  146</span>                closeUnclaimed();</div>
<div class="line"><span class="lineno">  147</span>                m_fds.clear();</div>
<div class="line"><span class="lineno">  148</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a2f582637609cc462d294d89f5745063f" name="a2f582637609cc462d294d89f5745063f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f582637609cc462d294d89f5745063f">&#9670;&#160;</a></span>closeUnclaimed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cosmos::UnixRightsMessage::closeUnclaimed </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="unix__aux_8cxx_source.html#l00059">59</a> of file <a class="el" href="unix__aux_8cxx_source.html">unix_aux.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   59</span>                                       {</div>
<div class="line"><span class="lineno">   60</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="#a158cec8051637e1422fd38f99bd60e80">m_unclaimed_fds</a>) {</div>
<div class="line"><span class="lineno">   61</span>                <span class="keywordflow">for</span> (<span class="keyword">auto</span> fd: m_fds) {</div>
<div class="line"><span class="lineno">   62</span>                        <a class="code hl_class" href="classcosmos_1_1FileDescriptor.html">cosmos::FileDescriptor</a>{fd}.<a class="code hl_function" href="classcosmos_1_1FileDescriptor.html#a7d8cb113b20ab2a267a545f878a5c3c8">close</a>();</div>
<div class="line"><span class="lineno">   63</span>                }</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>                m_fds.clear();</div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span>                <a class="code hl_variable" href="#a158cec8051637e1422fd38f99bd60e80">m_unclaimed_fds</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   68</span>        }</div>
<div class="line"><span class="lineno">   69</span>}</div>
<div class="ttc" id="aclasscosmos_1_1FileDescriptor_html"><div class="ttname"><a href="classcosmos_1_1FileDescriptor.html">cosmos::FileDescriptor</a></div><div class="ttdoc">Thin Wrapper around OS file descriptors.</div><div class="ttdef"><b>Definition</b> <a href="FileDescriptor_8hxx_source.html#l00035">FileDescriptor.hxx:35</a></div></div>
<div class="ttc" id="aclasscosmos_1_1FileDescriptor_html_a7d8cb113b20ab2a267a545f878a5c3c8"><div class="ttname"><a href="classcosmos_1_1FileDescriptor.html#a7d8cb113b20ab2a267a545f878a5c3c8">cosmos::FileDescriptor::close</a></div><div class="ttdeci">void close()</div><div class="ttdoc">Explicitly close the contained FD.</div><div class="ttdef"><b>Definition</b> <a href="FileDescriptor_8cxx_source.html#l00017">FileDescriptor.cxx:17</a></div></div>
<div class="ttc" id="aclasscosmos_1_1UnixRightsMessage_html_a158cec8051637e1422fd38f99bd60e80"><div class="ttname"><a href="#a158cec8051637e1422fd38f99bd60e80">cosmos::UnixRightsMessage::m_unclaimed_fds</a></div><div class="ttdeci">bool m_unclaimed_fds</div><div class="ttdoc">Flag whether &quot;live&quot; FDs in m_fds have not yet been collected.</div><div class="ttdef"><b>Definition</b> <a href="unix__aux_8hxx_source.html#l00171">unix_aux.hxx:171</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acd2460013a7494db244bffcf7ce6d39e" name="acd2460013a7494db244bffcf7ce6d39e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd2460013a7494db244bffcf7ce6d39e">&#9670;&#160;</a></span>deserialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void cosmos::UnixRightsMessage::deserialize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="classcosmos_1_1ReceiveMessageHeader_1_1ControlMessage.html">ReceiveMessageHeader::ControlMessage</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>msg</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse received file descriptors from the given ControlMessage. </p>
<p>If <code>msg</code> is not of the right type then an exception is thrown.</p>
<p>On success check <code>numFDs()</code> to learn of the amount of received file descriptors and use <code>takeFDs()</code> to transfer ownership of them to the caller. </p>

<p class="definition">Definition at line <a class="el" href="unix__aux_8cxx_source.html#l00020">20</a> of file <a class="el" href="unix__aux_8cxx_source.html">unix_aux.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   20</span>                                                                                 {</div>
<div class="line"><span class="lineno">   21</span>        this-&gt;checkMsg(msg, UnixMessage::RIGHTS);</div>
<div class="line"><span class="lineno">   22</span> </div>
<div class="line"><span class="lineno">   23</span>        clearFDs();</div>
<div class="line"><span class="lineno">   24</span> </div>
<div class="line"><span class="lineno">   25</span>        <span class="keyword">const</span> uint8_t *data = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>uint8_t*<span class="keyword">&gt;</span>(msg.data());</div>
<div class="line"><span class="lineno">   26</span> </div>
<div class="line"><span class="lineno">   27</span>        <span class="keyword">auto</span> left = msg.dataLength();</div>
<div class="line"><span class="lineno">   28</span>        <a class="code hl_enumeration" href="fs_2types_8hxx.html#a468b915608e0674d5789c5386b72ff92">FileNum</a> fd;</div>
<div class="line"><span class="lineno">   29</span> </div>
<div class="line"><span class="lineno">   30</span>        <span class="keywordflow">while</span> (left &gt;= <span class="keyword">sizeof</span>(fd)) {</div>
<div class="line"><span class="lineno">   31</span>                std::memcpy(&amp;fd, data, <span class="keyword">sizeof</span>(fd));</div>
<div class="line"><span class="lineno">   32</span>                data += <span class="keyword">sizeof</span>(fd);</div>
<div class="line"><span class="lineno">   33</span>                left -= <span class="keyword">sizeof</span>(fd);</div>
<div class="line"><span class="lineno">   34</span>                m_fds.push_back(fd);</div>
<div class="line"><span class="lineno">   35</span>        }</div>
<div class="line"><span class="lineno">   36</span> </div>
<div class="line"><span class="lineno">   37</span>        <span class="keywordflow">if</span> (!m_fds.empty()) {</div>
<div class="line"><span class="lineno">   38</span>                <a class="code hl_variable" href="#a158cec8051637e1422fd38f99bd60e80">m_unclaimed_fds</a> = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   39</span>        }</div>
<div class="line"><span class="lineno">   40</span>}</div>
<div class="ttc" id="afs_2types_8hxx_html_a468b915608e0674d5789c5386b72ff92"><div class="ttname"><a href="fs_2types_8hxx.html#a468b915608e0674d5789c5386b72ff92">cosmos::FileNum</a></div><div class="ttdeci">FileNum</div><div class="ttdoc">Primitive file descriptor.</div><div class="ttdef"><b>Definition</b> <a href="fs_2types_8hxx_source.html#l00032">types.hxx:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1101cf181018fe4c71869a0e35cdf4d6" name="a1101cf181018fe4c71869a0e35cdf4d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1101cf181018fe4c71869a0e35cdf4d6">&#9670;&#160;</a></span>numFDs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t cosmos::UnixRightsMessage::numFDs </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00160">160</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  160</span>                              {</div>
<div class="line"><span class="lineno">  161</span>                <span class="keywordflow">return</span> <a class="code hl_variable" href="#a158cec8051637e1422fd38f99bd60e80">m_unclaimed_fds</a> ? m_fds.size() : 0;</div>
<div class="line"><span class="lineno">  162</span>        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab78d135cd2c3549c9fb49f0b21ee5a0a" name="ab78d135cd2c3549c9fb49f0b21ee5a0a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab78d135cd2c3549c9fb49f0b21ee5a0a">&#9670;&#160;</a></span>serialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classcosmos_1_1SendMessageHeader_1_1ControlMessage.html">SendMessageHeader::ControlMessage</a> cosmos::UnixRightsMessage::serialize </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serialize a ControlMessage for passing file descriptors. </p>
<p>This will serialize a ControlMessage containing all file descriptors previously added via <code>addFD()</code>. </p>

<p class="definition">Definition at line <a class="el" href="unix__aux_8cxx_source.html#l00042">42</a> of file <a class="el" href="unix__aux_8cxx_source.html">unix_aux.cxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   42</span>                                                                   {</div>
<div class="line"><span class="lineno">   43</span>        <span class="keywordflow">if</span> (m_fds.empty()) {</div>
<div class="line"><span class="lineno">   44</span>                cosmos_throw (UsageError(<span class="stringliteral">&quot;Attempt to serialize empty vector of FileNum&quot;</span>));</div>
<div class="line"><span class="lineno">   45</span>        }</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>        <span class="keyword">auto</span> ret = this-&gt;createMsg(UnixMessage::RIGHTS, <span class="keyword">sizeof</span>(FileNum) * m_fds.size());</div>
<div class="line"><span class="lineno">   48</span> </div>
<div class="line"><span class="lineno">   49</span>        <span class="keyword">auto</span> data = this-&gt;data(ret);</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>        <span class="keywordflow">for</span> (<span class="keyword">auto</span> fd: m_fds) {</div>
<div class="line"><span class="lineno">   52</span>                std::memcpy(data, &amp;fd, <span class="keyword">sizeof</span>(fd));</div>
<div class="line"><span class="lineno">   53</span>                data += <span class="keyword">sizeof</span>(fd);</div>
<div class="line"><span class="lineno">   54</span>        }</div>
<div class="line"><span class="lineno">   55</span> </div>
<div class="line"><span class="lineno">   56</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="lineno">   57</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab58eec3d7df2910868dc8c9a830fe2c0" name="ab58eec3d7df2910868dc8c9a830fe2c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab58eec3d7df2910868dc8c9a830fe2c0">&#9670;&#160;</a></span>takeFDs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void cosmos::UnixRightsMessage::takeFDs </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="#a2db86e45a6ca216b888fb502c353f72d">FileNumVector</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>fds</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00150">150</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  150</span>                                         {</div>
<div class="line"><span class="lineno">  151</span>                <span class="keywordflow">if</span> (!<a class="code hl_variable" href="#a158cec8051637e1422fd38f99bd60e80">m_unclaimed_fds</a>) {</div>
<div class="line"><span class="lineno">  152</span>                        fds.clear();</div>
<div class="line"><span class="lineno">  153</span>                        <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  154</span>                }</div>
<div class="line"><span class="lineno">  155</span>                fds = std::move(m_fds);</div>
<div class="line"><span class="lineno">  156</span>                m_fds = <a class="code hl_typedef" href="#a2db86e45a6ca216b888fb502c353f72d">FileNumVector</a>{};</div>
<div class="line"><span class="lineno">  157</span>                <a class="code hl_variable" href="#a158cec8051637e1422fd38f99bd60e80">m_unclaimed_fds</a> = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  158</span>        }</div>
<div class="ttc" id="aclasscosmos_1_1UnixRightsMessage_html_a2db86e45a6ca216b888fb502c353f72d"><div class="ttname"><a href="#a2db86e45a6ca216b888fb502c353f72d">cosmos::UnixRightsMessage::FileNumVector</a></div><div class="ttdeci">std::vector&lt; FileNum &gt; FileNumVector</div><div class="ttdoc">A vector to keep a series of FileNum file descriptor numbers to pass between processes.</div><div class="ttdef"><b>Definition</b> <a href="unix__aux_8hxx_source.html#l00111">unix_aux.hxx:111</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a74768d1da14c864ae441ada8a295afa2" name="a74768d1da14c864ae441ada8a295afa2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74768d1da14c864ae441ada8a295afa2">&#9670;&#160;</a></span>m_fds</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="#a2db86e45a6ca216b888fb502c353f72d">FileNumVector</a> cosmos::UnixRightsMessage::m_fds</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00170">170</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>

</div>
</div>
<a id="a158cec8051637e1422fd38f99bd60e80" name="a158cec8051637e1422fd38f99bd60e80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a158cec8051637e1422fd38f99bd60e80">&#9670;&#160;</a></span>m_unclaimed_fds</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool cosmos::UnixRightsMessage::m_unclaimed_fds = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag whether "live" FDs in m_fds have not yet been collected. </p>

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00171">171</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>

</div>
</div>
<a id="a302b6595fb59f78b80fff09d13a57207" name="a302b6595fb59f78b80fff09d13a57207"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a302b6595fb59f78b80fff09d13a57207">&#9670;&#160;</a></span>MAX_FDS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t cosmos::UnixRightsMessage::MAX_FDS = 253</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maximum number of file descriptors that can be transferred using a single <a class="el" href="classcosmos_1_1UnixRightsMessage.html" title="Wrapper for the SCM_RIGHTS socket ancillary message to pass file descriptors to other processes.">UnixRightsMessage</a>. </p>

<p class="definition">Definition at line <a class="el" href="unix__aux_8hxx_source.html#l00116">116</a> of file <a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>include/net/<a class="el" href="unix__aux_8hxx_source.html">unix_aux.hxx</a></li>
<li>src/net/<a class="el" href="unix__aux_8cxx_source.html">unix_aux.cxx</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>cosmos</b></li><li class="navelem"><a class="el" href="classcosmos_1_1UnixRightsMessage.html">UnixRightsMessage</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
